<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device integration: Hello world from our device :: Embedded Wizard Tutorial</title>
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script src="../../_/js/email-obfuscator.js"></script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../index.html">Embedded Wizard Tutorial</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://ask.embedded-wizard.de/" target="_blank">Ask for help</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="https://github.com/deining/EmWiTutorial" target="_blank">Project on GitHub </a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/deining/EmWiTutorial/tree/master/src" target="_blank">Sources (Embedded Wizard)</a>
            <a class="navbar-item" href="https://github.com/deining/EmWiTutorial/tree/master/www/asciidoc/modules" target="_blank">Markup tutorial site (AsciiDoc)</a>
            <a class="navbar-item" href="https://github.com/deining/EmWiTutorial/tree/master/docs" target="_blank">Tutorial website (HMTL)</a>
            <a class="navbar-item" href="https://github.com/deining/EmWiTutorial/issues" target="_blank">Report an issue</a>
            <a class="navbar-item" href="https://github.com/deining/EmWiTutorial/pulls" target="_blank">Create a pull request</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="https://www.embedded-wizard.de/">Embedded Wizard</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://www.embedded-wizard.de/features/" target="_blank">Features</a>
            <a class="navbar-item" href="https://www.embedded-wizard.de/platforms/" target="_blank">Platforms</a>
            <a class="navbar-item" href="https://www.embedded-wizard.de/features/services/" target="_blank">Services</a>
            <a class="navbar-item" href="https://www.embedded-wizard.de/features/support/" target="_blank">Support</a>
            <a class="navbar-item" href="https://www.embedded-wizard.de/features/cases/" target="_blank">Use cases</a>
            <a class="navbar-item" href="https://www.embedded-wizard.de/features/demo/" target="_blank">Demos</a>
            <a class="navbar-item" href="https://www.embedded-wizard.de/features/news/" target="_blank">News</a>
            <a class="navbar-item" href="https://www.embedded-wizard.de/features/pricing/" target="_blank">Pricing</a>
            <a class="navbar-item" href="https://www.embedded-wizard.de/features/download/" target="_blank">Download</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="https://doc.embedded-wizard.de/" target="_blank">EmWi documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://doc.embedded-wizard.de/basic-concepts" target="_blank">Basic concepts</a>
            <a class="navbar-item" href="https://doc.embedded-wizard.de/working-with-embedded-wizard" target="_blank">Working with Embedded Wizard</a>
            <a class="navbar-item" href="https://doc.embedded-wizard.de/platform-integration-and-build-environments" target="_blank">Platform Integration</a>
            <a class="navbar-item" href="https://doc.embedded-wizard.de/embedded-wizard-studio" target="_blank">Embedded Wizard Studio</a>
            <a class="navbar-item" href="https://doc.embedded-wizard.de/chora-reference" target="_blank">Programming language chora</a>
            <a class="navbar-item" href="https://doc.embedded-wizard.de/mosaic_overview" target="_blank">Framework Mosaic</a>
            <a class="navbar-item" href="https://doc.embedded-wizard.de/release-notes" target="_blank">Release notes</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="DownloadCode.html">Download code</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="EmWiTutorial" data-version="latest">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="Introduction.html">Embedded Wizard Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Lessons</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Authoring your first application</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="HelloWorld.html">Getting started with 'Hello world!'</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="FirstComponent.html">Adding your first GUI component</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ComponentReusability.html">Making your GUI component truly reusable</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="DeviceIntegrationBrowser.html">Integrating with browser device</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Localizing your application</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="LocalizingYourApplication.html">Adding languages and localizing your strings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="LanguageSwitcher.html">Adding a language switcher</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="DemoSite.html">Application demo site</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="DownloadCode.html">Download source code</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Embedded Wizard Tutorial</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Embedded Wizard Tutorial</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="Introduction.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="Introduction.html">Embedded Wizard Tutorial</a></li>
    <li class="crumb">Lessons</li>
    <li class="crumb"><a href="DeviceIntegrationBrowser.html">Integrating with browser device</a></li>
  </ul>
</nav>
</div>
<article class="doc">
<h1>Device integration: Hello world from our device</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In the <a href="ComponentReusability.html" class="page">last chapter</a>, we made our component truly reusable by adding properties to it. Afterwards we completed our GUI which now contains two units, one for ringing a bell and another for showing the weather forecast. Unfortunately, there&#8217;s no real function behind the push buttons of both units yet. We will address this in the following chapter.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gui_builder_and_platform_packages"><a class="anchor" href="#_gui_builder_and_platform_packages"></a>GUI builder and platform packages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Embedded Wizard is a GUI framework builder that allows you to build GUI platform independent applications that can deployed on many different target systems. This is achieved by using the programming language Chora for all programming tasks related to the GUI. Other than that, Embedded Wizards strictly refrains from any access to the underlying device to ensure platform independence. However, when building embedded devices, the main purpose of the GUI application is to enable and facilitate interaction with the underlying hardware. So how does Embedded Wizard integrate with those devices? That&#8217;s where the concept of <a href="https://doc.embedded-wizard.de/platform-package" target="_blank" rel="noopener">platform packages</a> comes into play. Embedded Wizard offers platform packages for many different hardware platforms (STM, NXP, TI, Raspberry Pi, &#8230;&#8203;). A platform package consists of a code generator, a resource converter, a graphics engine and a runtime environment for the specific platform. You may think of the platform package as a link between the GUI and the hardware. Applications implemented in the programming language Chora can be run on any particular platform if a platform package exists for that platform.</p>
</div>
<hr>
<div class="sidebarblock">
<div class="content">
<div class="title">Source code</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you didn&#8217;t author or didn&#8217;t keep the <em>Reusable component</em> project explained in the previous <a href="ComponentReusability.html" class="page">chapter</a>, you may download the <a href="_attachments/code/ReusableComponentTutorial.zip">sources</a> of this project and use this a starting base to follow the instructions given below.
</td>
</tr>
</table>
</div>
</div>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_adapting_the_project_structure"><a class="anchor" href="#_adapting_the_project_structure"></a>Adapting the project structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As explained above, there is a strict separation between the GUI application and the device, represented by one or more platform packages. Let&#8217;s start and reflect that separation in our application structure, too:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on the <span class="image"><img src="_images/icons/EmbeddedWizardIcon.png" alt="project icon"></span> <em>Project</em> tab (the first tab from the left).</p>
</li>
<li>
<p>Identify the note frame that holds the icon <span class="image"><img src="_images/icons/ApplicationUnitIcon.png" alt="Icon application unit"></span> that represents the application unit. Rename the heading text of this frame from <em>Project Units</em> to <em>GUI project</em>. To do so, change the property <em>Caption</em> of the note frame using the inspector window.</p>
</li>
<li>
<p>From the gallery templates window to the left, drag an element <span class="image"><img src="_images/icons/AnnotationGroupIcon.png" alt="annotation group icon"></span> <em>Annotation Group</em> over to root canvas. Rename the group to <em>Middleware</em>.</p>
</li>
<li>
<p>Drag an element <span class="image"><img src="_images/icons/UnitIcon.png" alt="annotation group icon"></span> <em>Unit</em> over to root canvas, add the new unit inside the note rectangle you inserted in the previous step. Rename the unit to <em>Device</em>.</p>
</li>
<li>
<p>Drag another <span class="image"><img src="_images/icons/UnitIcon.png" alt="annotation group icon"></span> <em>Unit</em> into the same note rectangle <em>Middleware</em>. Rename the unit to <em>BrowserDevice</em>.</p>
</li>
<li>
<p>Drag a third <span class="image"><img src="_images/icons/UnitIcon.png" alt="annotation group icon"></span> <em>Unit</em> into the note rectangle <em>Middleware</em>. Rename the unit to <em>TargetDevice</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The structure of your project should now look as shown in <a href="#fig:ExtendedProjectLayout">Figure 1</a> below:</p>
</div>
<div id="fig:ExtendedProjectLayout" class="imageblock">
<div class="content">
<img src="_images/deviceintegration/ProjectStructure.png" alt="project layout">
</div>
<div class="title">Figure 1. Extended project layout</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_a_interface_device_class"><a class="anchor" href="#_adding_a_interface_device_class"></a>Adding a interface device class</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s add content to the newly inserted units! We start with adding a device class interface first:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Double click on the icon <span class="image"><img src="_images/icons/DeviceUnitIcon.png" alt="Icon device unit"></span>, representing the <em>Device</em> unit. This will open the unit in a new tab.</p>
</li>
<li>
<p>In the gallery templates window left to the main composer window (<span class="keyseq"><kbd>Alt</kbd>+<kbd>1</kbd></span>), either click on the folder header <em><strong>D</strong>evice</em> or press key <kbd>D</kbd>, this will open the folder and will present all <em><strong>d</strong>evice</em> subitems.</p>
</li>
<li>
<p>Click on the item <span class="image"><img src="_images/icons/DeviceInterfaceIcon.png" alt="Device interface icon"></span> <em>Device interface</em>, and drag an instance over to the component&#8217;s canvas. Place the element in the upper left corner of the canvas.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By dragging over the <em>device interface</em> to the canvas, two new objects were inserted:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <em>DeviceClass</em> element to the left, which represents the class where we will store device related class members like commands, properties and so on, and</p>
</li>
<li>
<p>the <em>Device</em> autoobject element associated to the <em>DeviceClass</em> element. This autoobject represents the globally available instance of the device class. This autoobject represents Embedded Wizard&#8217;s implementation of the <a href="https://en.wikipedia.org/wiki/Singleton_pattern">singleton pattern</a> (if you are familiar with Java, you may think of the <em>Device</em> class as a static class). Using the <em>Device</em> autoobject, any GUI element has direct access to the device class and its members, which is very handy. We will use this autoobject soon.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your screen should now look like illustrated in <a href="#fig:DeviceClassInterface">Figure 2</a> below:</p>
</div>
<div id="fig:DeviceClassInterface" class="imageblock">
<div class="content">
<img src="_images/deviceintegration/DeviceClassInterface.png" alt="device class interface">
</div>
<div class="title">Figure 2. Device class interface</div>
</div>
<div class="paragraph">
<p>Let&#8217;s go ahead and review and adapt the members of the newly inserted device class interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Double click on the icon <span class="image"><img src="_images/icons/DeviceAutoObjectIcon.png" alt="Icon autoobject"></span>, representing the <em>Device</em> autoobject. This will open the <em>Device</em> class in a new tab. You will see that the canvas was prepopulated with several class members already.</p>
</li>
<li>
<p>Identify the note group that holds the icon <span class="image"><img src="_images/icons/CommandMethodIcon.png" alt="Command method icon"></span> representing the <em>Command</em> method and rename the caption of this note group from <em>Example of an interface to perform an operation in the device</em> to <em>Command(s)</em>.</p>
</li>
<li>
<p>Rename icon <span class="image"><img src="_images/icons/CommandMethodIcon.png" alt="Command method icon"></span> representing the <em>Command</em> method to <em>RingTheBellCommand</em>.</p>
</li>
<li>
<p>Double click on the renamed command. In the code editor window, you will see the method&#8217;s signature, followed by many lines of template Chora code.</p>
</li>
<li>
<p>Have a look at the method signature of the <em>RingTheBell</em> command.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Device commands are represented by regular methods. Like in all programming languages, a method can take parameters and can have a return value. Have a look at the signature of the <em>RingTheBellCommand</em> method shown at the top of the code editor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-chora hljs" data-lang="chora"> method int32 Device::DeviceClass.RingTheBellCommand( arg int32 aParameter1, arg bool aParameter2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the method currently takes an int32 value as first argument and a boolean value as second argument. Also, the method returns an int32 value. These settings are not what we want, our simple <em>RingTheBellCommand</em> method does not need any parameters and won&#8217;t return anything, so the return type should be <em>void</em>. Let&#8217;s go ahead and adjust the method&#8217;s signature to our needs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the top title line of the code editor containing the method signature, you can see a small downwards triangle. Click on this triangle to show a frame where the method&#8217;s return value and parameters are listed in separate lines.</p>
</li>
<li>
<p>Right click on the first method parameter <em>arg int32 aParameter1</em> to invoke the context menu on this parameter. From this menu select the menu item <em>Delete</em> to remove the first parameter.</p>
</li>
<li>
<p>Right click on the remaining method parameter <em>arg bool aParameter2</em>. From the context menu shown, select <em>Delete</em> to remove this parameter, too.</p>
</li>
<li>
<p>Right click on the first line that shows the method&#8217;s name <em>method int32 RingTheBellCommand</em>. From the context menu shown, select <em>Edit</em> and change the return parameter from <em>int32</em> to <em>void</em>.</p>
</li>
</ul>
</div>
<div id="fig:DeleteMethodsParameter" class="imageblock">
<div class="content">
<img src="_images/deviceintegration/DeleteMethodParameters.png" alt="delete methods parameters">
</div>
<div class="title">Figure 3. Delete methods parameters</div>
</div>
<div class="paragraph">
<p>Once we adjusted the signature of the method, let us adjust the body of the method, too. Remove all template code and put in one single line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-chora hljs" data-lang="chora">trace "The device class of the GUI is an interface only and cannot run any device commands! Please implement the command in a variant class!";</code></pre>
</div>
</div>
<div class="paragraph">
<p>As said, Embedded Wizard does not have access to the underlying device and therefore cannot advise the device to say <em>Hello</em> to us. We have to implement this in a derived class, we will do so shortly.</p>
</div>
<div class="paragraph">
<p>Since we have set up a device and a command now, let&#8217;s use it and wire the push button action of the bell to that newly created command:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bring up the contents of the main application inside the tab <em>Application::TutorialApplication</em>.</p>
</li>
<li>
<p>Double click on the icon <span class="image"><img src="_images/icons/RingTheBellSlotIcon.png" alt="slot icon"></span> representing the slot method <em>RingTheBellSlot</em>. Inside the code editor, you will see the line <code>trace "Sorry, the GUI cannot ring the bell!";</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Change this code to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-chora hljs" data-lang="chora">Device::Device.RingTheBellCommand();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Embedded Wizard code editor ships with integrated code completion, which is very handy and might prevent you from typos when authoring code inside the code editor. To test it out, simply write <em>Device::</em> into the editor and should see a list of available completions to the given <em>Device</em> unit name you just typed in.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>That&#8217;s how we call a method by code: specify the class name (<em>Device::DeviceClass</em>) first, then append the method name (<em>RingTheBellCommand</em>), prepended with a dot and terminated with empty parentheses.
Now run your code using the prototyper, and you should see a trace message informing you that the GUI cannot run any device commands. Obviously, we are not at the end, so read on!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_another_profile"><a class="anchor" href="#_adding_another_profile"></a>Adding another profile</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As already explained above, there is a strict separation between the GUI application and the device, represented by one or more platform packages. Two platform packages are included in the Embedded Wizard installer and are available out of the box:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <em>Tara.Win32.xxx</em> platform package. This is the default platform package that allows you to run the application on your Windows platform. You were using it already when you launched the prototyper to run your application or component (<em>xxx</em> stand for one of the available color formats, either Index8 or RGBxxxxx).</p>
</li>
<li>
<p>the <em>Tara.WebGL.RGBA8888</em> platform. This WebGL/Javascript platform package allows you to run the GUI in any WebGL enabled browser. That&#8217;s especially handy for this tutorial since you don&#8217;t need any hardware to follow the instruction given.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Besides the Win32 and the WebGL packages there are many platform packages available to target real hardware (STM, NXP, TI, Raspberry Pi, &#8230;&#8203;). For each of these platform packages, a separate installer exists. You have to obtain and run this installer to make the associated platform packages available inside Embedded Wizard.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If we want to make use of more than one platform package inside our project, we have to have an associated <strong><a href="https://doc.embedded-wizard.de/profile-member">profile</a></strong> on the Projects tab for each package you would like to use. So let&#8217;s add another profile that allows us to switch between the Win32 package and the WebGL package. We then use the latter package to output <em>Hello, world!</em> on the browser device, more specifically on the web console of the browser. The journey goes on &#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on the <span class="image"><img src="_images/icons/EmbeddedWizardIcon.png" alt="project icon"></span> <em>Project</em> tab (the first tab from the left).</p>
</li>
<li>
<p>Identify the note frame with the caption <em>Profile configuration</em>, it only contains the icon <span class="image"><img src="_images/icons/DefaultProfileIcon.png" alt="Default profile icon"></span> representing the default profile. Select this profile and have a look at the inspector window. You will realize that the attribute <em>PlatformPackage</em> of the profile has the value <em>Tara.Win32.RGBA8888</em> assigned. To reflect this, rename the profile from <em>Profile</em> to <em>Win32</em> using the <kbd>F2</kbd> key.</p>
</li>
<li>
<p>From the gallery templates window to the left, drag the element <span class="image"><img src="_images/icons/ProfileIcon.png" alt="profile icon"></span> <em>Profile</em> inside the <em>Chora</em> folder over to the canvas and place it underneath the existing profile <em>Win32</em> . Rename the profile to <em>Browser</em>. Resize the note frame and rearrange the elements on the canvas so that the layout looks nice again.</p>
</li>
<li>
<p>Our new profile should be associated with the WebGL platform package, so inside the inspector window, change the value of the attribute <em>PlatformPackage</em> from <em>Tara.Win32.RGBA8888</em> to <em>Tara.WebGL.RGBA8888</em>.</p>
</li>
<li>
<p>Inside the inspector window, change the value of the attribute <em>ScreenSize</em> to <em>&lt;480,320&gt;</em>.</p>
</li>
<li>
<p>Also change the value of the attribute <em>OutputDirectory</em> to <em>../WebGL</em>. This defines the directory where all the code for our website will be stored once we build the project.</p>
</li>
<li>
<p>Optionally, you may fill the attributes <em>ApplicationName</em> and <em>ApplicationTitle</em> with the values <em>TutorialApplication</em> or <em>"Embedded Wizard sample application"</em>, respectively. For the last value, don&#8217;t forget the surrounding double quotes here or you may run in trouble.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>Profile</em> section of your project should now look as shown in <a href="#fig:ProjectProfiles">Figure 4</a> below:</p>
</div>
<div id="fig:ProjectProfiles" class="imageblock">
<div class="content">
<img src="_images/deviceintegration/ProjectProfiles.png" alt="Project profiles">
</div>
<div class="title">Figure 4. Project profiles and their attributes</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Now that we have two profiles defined, we can switch between these two profiles using the <a href="https://doc.embedded-wizard.de/menu-build#9" target="_blank" rel="noopener"><em>Profile</em> dropdown list</a> located in the second row of the toolbar, placed right beneath the icon <span class="image"><img src="_images/icons/BuildProfileIcon.png" alt="Build profile"></span> for building the selected profile and the icon <span class="image"><img src="_images/icons/BuildBatchIcon.png" alt="Build batch mode"></span> for building multiple profiles in batch mode:</p>
</div>
<div id="fig:DropdownList" class="imageblock">
<div class="content">
<img src="_images/deviceintegration/DropdownProfiles.png" alt="dropdown list profiles">
</div>
<div class="title">Figure 5. Dropdown list for switching between different profiles</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_a_browser_device_class_variant"><a class="anchor" href="#_adding_a_browser_device_class_variant"></a>Adding a browser device class variant</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We already added an interface device class to our project. However, this interface device class is not meant to run any command on the device. The actual execution of the command on the device will happen inside a <a href="https://doc.embedded-wizard.de/class-variant-member">class variant</a>. <a href="https://doc.embedded-wizard.de/managing-project-variants">Variants</a> are an extremely powerful concept of Embedded wizard, in the example below we use it to manage code execution on different platform packages. Variants are useful in various other scenarios, you may use them to manage variants of your application for different screen resolutions or if you want to implement a different look and feel for one or more application components. Let&#8217;s go ahead and add and populate a class variant for the use with browser devices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on the <span class="image"><img src="_images/icons/EmbeddedWizardIcon.png" alt="project icon"></span> <em>Project</em> tab (the first tab from the left).</p>
</li>
<li>
<p>Identify the note frame with the caption <em>Middleware</em> which holds three device units, the <em>Device</em> unit, the <em>BrowserDevice</em> unit and the <em>TargetDevice</em> unit.</p>
</li>
<li>
<p>Double click on the icon <span class="image"><img src="_images/icons/BrowserDeviceUnitIcon.png" alt="Icon browser device unit"></span>, representing the <em>BrowserDevice</em> unit. This will open the empty unit inside a new tab.</p>
</li>
<li>
<p>Press <span class="keyseq"><kbd>Alt</kbd>+<kbd>2</kbd></span> to select the <a href="https://doc.embedded-wizard.de/gallery-browser-window">gallery browser window</a>, left to the main composer window. Alternatively, you may mouse click at the second tab <em>Browser</em> at the very top of the window.</p>
</li>
<li>
<p>In the search field immediately below the two tabs, type in <em>Device</em> to shorten the class list.</p>
</li>
<li>
<p>Right click on the <span class="image"><img src="_images/icons/ClassIcon.png" alt="class icon"></span> <em>Device::DeviceClass</em> class to invoke the context menu on this class. From this menu select the menu item <em>Copy</em> to copy the class to the clipboard.</p>
</li>
<li>
<p>Right click on the empty canvas in the main window to invoke a context menu. From this menu select the menu item <em>Variant paste</em> to insert a class variant of the device class. Alternatively, you may select the element and drag it over to the canvas while keeping <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Alt</kbd></span> pressed. Note the letter <em>V</em> in the icon <span class="image"><img src="_images/icons/VariantClassIcon.png" alt="variant class icon"></span> of the newly inserted class which marks the class as a class variant.</p>
</li>
<li>
<p>Rename the newly inserted variant class to <em>DeviceClassBrowser</em> using the <kbd>F2</kbd> key.</p>
</li>
<li>
<p>In the inspector window, locate the attribute line <em>VariantCond</em>. The right hand <em>value</em> cell of this attribute line holds a small downwards triangle at the right hand side. Click on this triangle to open the dropdown list populated with all profiles of your project. Deselect all profiles except for the profile <em>Browser</em> and click on the lower button labelled with a check mark to confirm your choice. With this setting in place, the class variant is now associated with the <em>Browser</em> profile only.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your screen should now look as shown in <a href="#fig:ClassVariant">Figure 6</a> below:</p>
</div>
<div id="fig:ClassVariant" class="imageblock">
<div class="content">
<img src="_images/deviceintegration/DeviceClassBrowser.png" alt="class variant" width="1024">
</div>
<div class="title">Figure 6. Browser device class variant</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementing_a_different_behavior_for_the_browser_device_class_variant"><a class="anchor" href="#_implementing_a_different_behavior_for_the_browser_device_class_variant"></a>Implementing a different behavior for the browser device class variant</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We want to make the newly created class behave differently, so there&#8217;s still some work to do:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Double click on the icon <span class="image"><img src="_images/icons/DeviceClassBrowserIcon.png" alt="Icon device class browser"></span>, representing the recently add device class variant. This will open the empty <em>DeviceClassBrowser</em> class variant inside a new tab.</p>
</li>
<li>
<p>From the gallery templates window to the left, drag an element <span class="image"><img src="_images/icons/AnnotationGroupIcon.png" alt="annotation group icon"></span> <em>Annotation Group</em> over to root canvas. Rename the group to <em>Command(s)</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Have a look at the inspector window and you will see the method <em>RingTheBellCommand</em>. This is the command we previously added to the <em>Device</em> class. Since the variant class is derived from this class, it has access to all its class members, including the <em>RingTheBellCommand</em>. The light grey colour of the method name marks the method as inherited. We now want to implement a different behavior for this command in the variant class, we can do so by overriding the method in the variant class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the inspector window, right click on the method <em>RingTheBellCommand</em> to invoke the context menu on the method. From this menu select the menu item <em>Override class member</em>. A method element with the same name <em>RingTheBellCommand</em> will appear on the canvas.</p>
</li>
<li>
<p>We are now able to specify different code in the method body of the newly created method: double click on the icon <span class="image"><img src="_images/icons/RingTheBellCommandIcon.png" alt="command method icon"></span> representing the newly inserted method <em>RingTheBellCommand</em>. Inside the code editor, you will see the line <code>// TO DO: Write your code here &#8230;&#8203; </code>. That&#8217;s great, we can add our custom code here which will be executed only once the browser device class variant was called!</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the code editor, add the following code inside the method body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-chora hljs" data-lang="chora">trace "Command on browser device was called";

$if (!$prototyper)
  native
  {
    // Javascript code executed inside the browser
    console.log("Hello, world!");
    console.log("We will be able to ring the bell shortly");
  }
$endif</code></pre>
</div>
</div>
<div class="paragraph">
<p>Eventually, we are revealing how Embedded Wizard can <a href="https://doc.embedded-wizard.de/integrating-with-the-device#1">execute native code</a> on the device: by making use of the <em><a href="https://doc.embedded-wizard.de/native-statement">native</a></em> statement of the Chora language. Any code inside this statement remains untouched and is passed <em>as is</em> to the device. Since we are communicating with browser devices, we have to put JavaScript code inside the <em>native</em> statement. More specifically, we make use of the <code>console.log()</code> method which outputs arbitrary text to the browser&#8217;s console.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The construct <code>$if (!$prototyper) &#8230;&#8203; $endif</code> around the <em>native</em> statement prevents the native code block from being executed once we are using the prototyper for previewing our components or our applications. By adding this statement, we prevent Embedded Wizard from raising a warning that native code will the ignored during prototyping.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>BrowserDevice</em> class variant should now look like as depicted in <a href="#fig:BrowserDeviceBellCommand">Figure 7</a> below:</p>
</div>
<div id="fig:BrowserDeviceBellCommand" class="imageblock">
<div class="content">
<img src="_images/deviceintegration/DeviceClassBrowserCommand.png" alt="browser device class variant">
</div>
<div class="title">Figure 7. Browser device class variant with command added</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_the_application_inside_a_web_browser"><a class="anchor" href="#_running_the_application_inside_a_web_browser"></a>Running the application inside a web browser</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hooray, we are now ready to run the application inside a web browser of your choice! To do, so, we have to build the browser specific code first:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Switch to the <em>Browser</em> profile using the dropdown list depicted in <a href="#fig:DropdownList">Figure 5</a> above.</p>
</li>
<li>
<p>Click on the the icon <span class="image"><img src="_images/icons/BuildProfileIcon.png" alt="Build profile"></span> for building the application for the selected <em>Browser</em> profile. The generated code will be written into the output directory <em>WebGL</em> on the root application level. We specified this output directory when creating the <em>Browser</em> profile.</p>
</li>
<li>
<p>Locate the output directory on your local file system. We contents of this directory should look like as depicted in <a href="#fig:WebGLFolder">Figure 8</a>.</p>
</li>
</ul>
</div>
<div id="fig:WebGLFolder" class="imageblock">
<div class="content">
<img src="_images/deviceintegration/OutputFolderWebGL.png" alt="output folder WebGL">
</div>
<div class="title">Figure 8. Contents of WebGL output folder</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Double click on the file <em>TutorialApplication.html</em> inside your <em>WebGL</em> output directory. This will open your default web browser with a window that runs your application:</p>
</li>
</ul>
</div>
<div id="fig:ApplicationBrowser" class="imageblock">
<div class="content">
<img src="_images/deviceintegration/ApplicationRunBrowser.png" alt="application inside browser">
</div>
<div class="title">Figure 9. executing the application inside a web browser</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Due to security concerns, the <em>Chrome</em> browser does not allow to load websites locally. We do <strong>not</strong> recommend the use of this browser for local preview of our application since most likely, you are running into trouble.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the Javascript console of your browser. The way how to achieve that depends on your browser:</p>
<div class="ulist">
<ul>
<li>
<p>Firefox: From the menu, select <span class="menuseq"><b class="menu">Tools</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Web developer</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Browser console</b></span> or use the keyboard shortcut <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>J</kbd></span></p>
</li>
<li>
<p>Microsoft Edge: Use the keyboard shortcut <kbd>F12</kbd> to open the Developer Tools, then click on the <em>Console</em> tab or press <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>2</kbd></span> to invoke that tab.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Inside the application in your browser window, click on the push button labelled <em>Ring</em>. From your browser console, you should be greeted with <em>Hello, world!</em>:</p>
</li>
</ul>
</div>
<div id="fig:BrowserConsole" class="imageblock">
<div class="content">
<img src="_images/deviceintegration/BrowserConsole.png" alt="browser console">
</div>
<div class="title">Figure 10. <em>Hello, world!</em> on the browser console</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_finalizing_device_actions"><a class="anchor" href="#_finalizing_device_actions"></a>Finalizing device actions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_make_the_device_beep_eventually"><a class="anchor" href="#_make_the_device_beep_eventually"></a>Make the device beep eventually</h3>
<div class="paragraph">
<p>In order to get results quickly, we made use of the <code>console.log()</code> inside the <em>RingTheBell</em> command. But we certainly can do better here, let&#8217;s move on and let the bell ring!</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the body of method <em>RingTheBellCommand</em>, remove the two lines with console.log statements and replace them with a single code line with a mere function call <code>beep();</code>. The code in the method body should now read:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-chora hljs" data-lang="chora">trace "Ring the bell command on browser device was called";

$if (!$prototyper)
  native
  {
    // Javascript code executed inside the browser
    beep();
  }
$endif</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function <em>beep()</em> does not exist yet, so let&#8217;s create it. We intentionally move this function out to the unit <em>BrowserDevice</em> in order to operate with small, separated code units.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select or open the tab with the unit <em>BrowserDevice</em>, the unit currently holds the variant class <em>DeviceClassBrowser</em> only.</p>
</li>
<li>
<p>Click on the <em>Templates</em> windows to the left or invoke it by using the keyboard shortcut <span class="keyseq"><kbd>Alt</kbd>+<kbd>1</kbd></span>. Press key <kbd>c</kbd> to open the folder <em>Chora</em> and show its elements.</p>
</li>
<li>
<p>Identify the item <span class="image"><img src="_images/icons/InlineCodeIcon.png" alt="inline code icon"></span> <em>Inline code</em>, representing a native code snippet. Click on the element, drag it into the main area and place it underneath the existing <em>DeviceClassBrowser</em> element.</p>
</li>
<li>
<p>Rename the newly inserted <em>inline code</em> element to <em>InlineFunctions</em> using the <kbd>F2</kbd> key.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>BrowserDevice</em> unit should now look like as depicted in <a href="#fig:BrowserDevice">Figure 11</a> below:</p>
</div>
<div id="fig:BrowserDevice" class="imageblock">
<div class="content">
<img src="_images/deviceintegration/UnitBrowserDevice.png" alt="browser device unit">
</div>
<div class="title">Figure 11. Browser device unit</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Double click on the icon <span class="image"><img src="_images/icons/InlineFunctionsIcon.png" alt="inline functions icon"></span> representing the inline code element. Inside the code editor, you will see a single code line <code>// TO DO: Write your code here &#8230;&#8203; </code>.</p>
</li>
<li>
<p>Using the code editor, insert the function <em>beep()</em> inside the body of the inline element:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>// reuse context since browsers limit the number of concurrent audio contexts
var audioContext = new AudioContext();

function beep() {
  var oscillatorNode = audioContext.createOscillator();
  var gainNode = audioContext.createGain();
  oscillatorNode.connect(gainNode);
  oscillatorNode.frequency.value = 500;
  oscillatorNode.type = "square";
  gainNode.connect(audioContext.destination);
  gainNode.gain.value = 1.5;
  oscillatorNode.start(audioContext.currentTime);
  oscillatorNode.stop(audioContext.currentTime + 0.2);
}</pre>
</div>
</div>
<div class="paragraph">
<p>Test that your device makes <em>beep</em> eventually:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure the profile <em>Browser</em> is selected and rebuild your project using the <kbd>F8</kbd> key.</p>
</li>
<li>
<p>Go to your web browser and issue a page refresh the browser page displaying your application using the <kbd>F5</kbd> key.</p>
</li>
<li>
<p>Click on the push-button labelled <em>Ring</em> and your PC should beep eventually, provided, it has a speaker built in.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_presenting_the_weather_forecast_on_the_browser_device"><a class="anchor" href="#_presenting_the_weather_forecast_on_the_browser_device"></a>Presenting the weather forecast on the browser device</h3>
<div class="paragraph">
<p>We are almost at the end of this long chapter! One task is left, however: we have to teach the browser device to display the weather forecast. That&#8217;s pretty easy, though:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select or open the tab with the variant class <em>DeviceClassBrowser</em>, this class currently holds the command method <em>RingTheBellCommand</em> only.</p>
</li>
<li>
<p>In the inspector window, right click on the method <em>ShowForecastCommand</em> to invoke the context menu on the method. From this menu select the menu item <em>Override class member</em>. A method element with the same name <em>ShowForecastCommand</em> will appear on the canvas. Rearrange elements so that the layout looks nice again if needed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The final <em>BrowserDevice</em> class variant should now look like as depicted in <a href="#fig:BrowserDeviceBellCommands">Figure 12</a> below:</p>
</div>
<div id="fig:BrowserDeviceBellCommands" class="imageblock">
<div class="content">
<img src="_images/deviceintegration/DeviceClassBrowserCommands.png" alt="browser device class variant">
</div>
<div class="title">Figure 12. Browser device class variant with two commands added</div>
</div>
<div class="ulist">
<ul>
<li>
<p>We are now able to specify different code in the method body of the newly created method: double click on the icon <span class="image"><img src="_images/icons/ShowForecastCommandIcon.png" alt="forecast command icon"></span> representing the newly inserted method <em>ShowForecastCommand</em>. Inside the code editor, you will see the line <code>// TO DO: Write your code here &#8230;&#8203; </code>. Again now we can add our custom code here which will be executed only once the browser device class variant was called.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the code editor, add the following code inside the method body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-chora hljs" data-lang="chora">trace "Show forecast command on browser device was called";

$if (!$prototyper)
  native
  {
    // Javascript: redirect to weather forecast page
    window.open('https://www.cnn.com/weather', '_self');
  }
$endif</code></pre>
</div>
</div>
<div class="paragraph">
<p>We are done! To test the newly added weather forecast functionality, rebuild the project and reload the application page in your web browser.
You should now be able to both make your device beep and to view the weather forecast inside your browser. Pretty cool, isn&#8217;t it?</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Source code</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you encountered difficulties and didn&#8217;t succeed when following the instructions given above, you may download the <a href="_attachments/code/DeviceIntegrationTutorial.zip">project sources</a> of the finalized example on how to integrate your browser device.
</td>
</tr>
</table>
</div>
</div>
</div>
<hr>
<div class="paragraph">
<p>Let&#8217;s move on to the <a href="LocalizingYourApplication.html" class="page">next chapter</a>, there&#8217;s still much more to explore!</p>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>This tutorial was authored and published by <script type="text/javascript">document.write("<a href='mailto:" + obfuscateEmail() + "'>")</script>Dr. Andreas Deininger</a> using the <a href="https://antora.org/" target="_blank">antora</a> publishing toolchain.<br/>
  This tutorial and the source code of the associated sample project are licensed under the terms of the MIT license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
